<!-- vi: se fdm=marker : -->
<tool id="mtbls-dwnld" name="Metabolights downloader" version="3.0">

	<description>Import ISA TAB data format from public and private MetaboLights studies</description>

	<!-- Command {{{1 -->

	<command><![CDATA[
		## @@@BEGIN_CHEETAH@@@

		$__tool_directory__/mtbls-dwnld

		-qq
		#if $token:
			-t "$token"
		#end if
		#if $type == 'private':
			-p
		#end if
		#if $downloader == 'aspera':
			-a
		#end if

		## Download only the metadata
		#if $metadata:
			-M
		#end if

		## Set output file
		-o "$isastudy.files_path"

		## Study to output
		"$study"

		## @@@END_CHEETAH@@@
	]]></command>

	<!-- Inputs {{{1 -->

	<inputs>

		<!-- Study name -->
		<param name="study" type="text" label="Study name" help="Study name in the form MTBLSXXXX. For downloading a private study with Aspera client, set to the full path of the study." refresh_on_change="true"/>

		<!-- Public or private -->
		<param name="type" label="Study type" type="select" help="Indicate here if the study you want to download is public or private.">
			<option value="public">Public</option>
			<option value="private">Private</option>
		</param>

		<!-- Downloader -->
		<param name="downloader" label="Downloader" type="select" help="If downloading only the metadata prefer wget, otherwise you can choose aspera for which you will need a token both in case of public and private data.">
			<option value="wget">wget</option>
			<option value="aspera">Aspera</option>
		</param>

		<!-- Metadata -->
		<param name="metadata" label="Download only the metadata" type="boolean" help="If set to 'No', found mzData and mzML files will be extracted and output as collections." checked="true" truevalue="yes" falsevalue=""/>

		<!-- Token -->
		<param name="token" type="text" optional="true" format="txt" label="Token"  help="Token is required for private study or for downloading with Aspera client."/>
	</inputs>

	<!-- Outputs {{{1 -->

    <outputs>
        <data name="isastudy" label="ISA of ${study}" format="isa"/>
    </outputs>

	<!-- Tests {{{1 -->
	<tests>
		<test>
			<param name="study" value="MTBLS30"/>
			<param name="type" value="public"/>
			<param name="downloader" value="wget"/>
			<param name="metadata" value="yes"/>
			<param name="token" value=""/>
			<output name="isastudy" file="what/file?"/>
		</test>
	</tests>

	<!-- Help {{{1 -->
    <help>
<!-- @@@BEGIN_RST@@@ -->

=======================
Metabolights Downloader
=======================

A tool to download data from MetaboLights studies. You can download either a private or a public study, using `wget` as well as `aspera` methods.

The following outputs are available:
 - A single assay in W4M three files format.
 - All assays in W4M three files format.
 - A collection of mzML files found inside the study.
 - A collection of mzData files found inside the study.

-------------
Input setting
-------------

Study name
==========

Fill this field with the name of the study you want to download.

.. class:: warningmark

In case of the download of a private study with *aspera* downloader, you must write the full path of the study, not only the name.

Study type
==========

You must select here the type of the study, which can be either *public* or *private*. In case of a *private* study, you will have to input a security token.

Downloader
==========

With this field, you can control the program used for downloading the study. You have the choice between standard *wget* and *aspera*. *wget* will download the data through *http*, while *aspera* will do it through *ftp*. If you are only interested in the metadata, choose *wget* since it is able to download only these data. If you are interested in *mzML* or *mzData* files, choose *aspera* as it is a faster downloader.

Metadata
========

If you are only interested in metadata, choose *Yes*, and make sure to select *wget* as well in the **Downloader** field.
If you set this field to *No*, then the tool will try to extract *mzData* and *mzML* files and output them as collections.

Token
=====

You need to provide a token when downloading with *aspera* (both for private and public studies), or when downloading a private study with *wget*.

-----------
Output file
-----------

<!-- @@@END_RST@@@ -->
    </help>

	<!-- Citations {{{1 -->
    <citations>
        <citation type="doi">10.1002/0471250953.bi1413s53</citation>
        <citation type="doi">10.1007/s11306-015-0879-3</citation>
        <citation type="doi">10.1038/ng.1054</citation>
    </citations>
</tool>
